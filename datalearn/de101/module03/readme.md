# Визуализация данных

С теорией ознакомился, переходим к практике

## 3.6 Разбор компонентов BI решения на примере Google Data Studio

На сколько я понимаю, здесь все максимально упрощено.

На одной странице происходит подключение к базе данных и выборка данных, которая может осуществлять как просто кликом мышкой, так  с помощью SQL запроса к бд (Авторизация и семантический слой)

!['authorization'](./img/3.6_BI_auth_and_conn.JPG)

различные шаблоны визуализации можно найти на страрнице редактирования отчета

!['visualisation_patterns'](./img/3.6_BI_groph_types.JPG)

здесь же рядом находятся фильтры

!['filters'](./img/3.6_BI_filters.JPG)

Измерения и показатели выбираются в процессе создания диаграмм

!['dimention_measures'](./img/3.6_BI_mesures.JPG)

Иерархии здесь не наблюдается - все свалено в одну кучу

!['data'](./img/3.6_BI_data.JPG)

API и интеграция языков программирования отсутствует.
В целом, учитывая доступность и простоту, вполне себе

## 3.7

## 3.8

## 3.9

## 3.10 Знакомство с Power BI

Первое впечатление производит странное. Примерно как Excel - мощный, но тяжелый и неповоротливый. Также, как для человека только знакомящегося с BI инструментами, напрягает реобходимость изучения дополнительных языков (M и DAX). Хорошо что есть возможность делать основные операции с помощью графического интерфейса

Переходим к ДЗ

### 1 преобразование в PowerQuery

Есть соблазн просто переместить необходимые значения в Excel и не мучаться, но что делать если количество ID будет не 21 а 210к и Типов которые надо разделить не 2 а 20...
В общем получилось вот по такому пути:

1. Создаём сводную таблицу
![шаг 1](./img/3.10.1.01.JPG)
вот с такими параметрами
![шаг 2](./img/3.10.1.02.JPG)
в результате получим вот такую таблицу
![шаг 3](./img/3.10.1.03.JPG)
почти то что нужно только горизонтально :)

2. Разворачиваем таблицу используя `Transpose`
![шаг 4](./img/3.10.1.04.JPG)
после этого используем певую строку как заголовки
![шаг 5](./img/3.10.1.05.JPG)
и вот уже больше похоже на то что нужно
![шаг 6](./img/3.10.1.06.JPG)

3. Добавляем индексы просто нажимая на `Index Column` и там выбираем `From 1`
![шаг 7](./img/3.10.1.07.JPG)

Готово!

### 2

Таблицу с типами категорий делать даже проще

1. Группируем по типу
![шаг 1](./img/3.10.2.01.JPG)
![шаг 2](./img/3.10.2.02.JPG)

2. Получаем такую таблицу.
![шаг 3](./img/3.10.2.03.JPG)
остается удалить лишние колонки и добавить индексы как ID

### 3

А вот здесь с наскоку не получилось. Надо копаться глубже..
За основу пробовал взять MoM % и привести формулу к своим нуждам. Но везде выдает 0.
если решу что буду работать с Power BI то буду углубляться, соответственно.

```DAX
Amount WoW% = 
IF(
 ISFILTERED('Calendar'[Date]),
 ERROR("Time intelligence quick measures can only be grouped or filtered by the Power BI-provided date hierarchy or primary date column."),
 VAR __PREV_week = CALCULATE(SUM('Fact'[Amount]), DATEADD('Calendar'[Date].[Date], -7, DAY)
    )
 RETURN
  DIVIDE(SUM('Fact'[Amount]) - __PREV_week, __PREV_week) * 100
)
```

### 4

Пересчитывать столбец `Ammount` в Power Query не стал, а вот меру сделать получилось :)

Чтобы не менять курс каждый день в ручную использовал JSON, который можно получить здесь `https://www.cbr-xml-daily.ru/daily_json.js`

Добавил источник данных JSON и преобразовал результат в таблицу, после чего добавил значение в формулу

```DAX
Euro price = CALCULATE(DIVIDE(SUM('Fact'[Amount]), LOOKUPVALUE('exchange course'[Value],'exchange course'[Name], "Valute.EUR.Value")))
```
